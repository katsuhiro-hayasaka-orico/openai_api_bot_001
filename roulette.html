<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>抽選ルーレット</title>
<style>
body{font-family:"Segoe UI","Hiragino Kaku Gothic ProN",Meiryo,sans-serif;margin:0;padding:20px;background:#f5f7fa;text-align:center;}
#container{max-width:600px;margin:auto;background:#fff;padding:20px;border-radius:8px;box-shadow:0 2px 10px rgba(0,0,0,0.1);}
textarea{width:100%;height:100px;margin-bottom:10px;}
canvas{display:block;margin:20px auto;}
#pointer{width:0;height:0;border-left:20px solid transparent;border-right:20px solid transparent;border-bottom:30px solid #e74c3c;margin:0 auto;}
#winner{font-size:1.5em;margin-top:10px;}
</style>
</head>
<body>
<div id="container">
<h1>抽選ルーレット</h1>
<p>参加者を1行ずつ入力してください。</p>
<textarea id="names" placeholder="名前を改行で入力"></textarea>
<button id="spin">回す</button>
<div id="pointer"></div>
<canvas id="wheel" width="500" height="500"></canvas>
<div id="winner"></div>
</div>
<script>
const colors=["#f94144","#f3722c","#f8961e","#f9844a","#f9c74f","#90be6d","#43aa8b","#577590","#277da1"]; 
const canvas=document.getElementById('wheel');
const ctx=canvas.getContext('2d');
const pointer=document.getElementById('pointer');
const winnerDiv=document.getElementById('winner');
const spinBtn=document.getElementById('spin');
let currentRotation=0;
function drawWheel(names){
    const radius=canvas.width/2;
    const arc=2*Math.PI/names.length;
    ctx.clearRect(0,0,canvas.width,canvas.height);
    for(let i=0;i<names.length;i++){
        ctx.beginPath();
        ctx.moveTo(radius,radius);
        ctx.fillStyle=colors[i%colors.length];
        ctx.arc(radius,radius,radius,arc*i,arc*(i+1));
        ctx.fill();
        ctx.save();
        ctx.translate(radius,radius);
        ctx.rotate(arc*i+arc/2);
        ctx.textAlign='right';
        ctx.fillStyle='#fff';
        ctx.font='bold 16px sans-serif';
        ctx.fillText(names[i],radius-10,5);
        ctx.restore();
    }
}
function playBeep(duration=100){
    const ctx=new(window.AudioContext||window.webkitAudioContext)();
    const osc=ctx.createOscillator();
    osc.type='sine';
    osc.frequency.setValueAtTime(600,ctx.currentTime);
    osc.connect(ctx.destination);
    osc.start();
    osc.stop(ctx.currentTime+duration/1000);
    osc.onended=()=>ctx.close();
}
spinBtn.onclick=()=>{
    const names=document.getElementById('names').value.trim().split(/\n+/).filter(Boolean);
    if(!names.length){alert('名前を入力してください');return;}
    drawWheel(names);
    const rotations=5; // full spins
    const randomDeg=Math.random()*360;
    const totalDeg=rotations*360+randomDeg;
    canvas.style.transition='transform 5s cubic-bezier(0.33,1,0.68,1)';
    canvas.style.transform=`rotate(${totalDeg+currentRotation}deg)`;
    playBeep();
    setTimeout(()=>{
        currentRotation=(currentRotation+totalDeg)%360;
        const slice=360/names.length;
        const index=Math.floor((360-currentRotation+slice/2)%360/slice);
        winnerDiv.textContent=`当選者: ${names[index]}`;
        playBeep(300);
    },5000);
};
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>シンプルオセロ</title>
<style>
  body { font-family: sans-serif; text-align: center; }
  #board { display: grid; grid-template-columns: repeat(8, 60px); grid-template-rows: repeat(8, 60px); margin: 20px auto; }
  .cell { width: 60px; height: 60px; border: 1px solid #333; background-color: green; position: relative; cursor: pointer; }
  .piece { border-radius: 50%; width: 50px; height: 50px; position: absolute; top:5px; left:5px; }
  .black { background: black; }
  .white { background: white; }
</style>
</head>
<body>
<h1>シンプルオセロ</h1>
<div id="info"></div>
<div id="board"></div>
<script>
const boardEl = document.getElementById('board');
const infoEl = document.getElementById('info');
const size = 8;
let board = [];
let currentPlayer = 1; //1:black, 2:white

function initBoard() {
  board = Array.from({length:size}, () => Array(size).fill(0));
  board[3][3] = 2;
  board[3][4] = 1;
  board[4][3] = 1;
  board[4][4] = 2;
}

function createBoardUI() {
  boardEl.innerHTML = '';
  for(let r=0;r<size;r++){
    for(let c=0;c<size;c++){
      const cell = document.createElement('div');
      cell.className='cell';
      cell.dataset.row=r;
      cell.dataset.col=c;
      cell.addEventListener('click', onCellClick);
      boardEl.appendChild(cell);
    }
  }
}

function drawBoard(){
  for(let r=0;r<size;r++){
    for(let c=0;c<size;c++){
      const idx = r*size + c;
      const cell = boardEl.children[idx];
      cell.innerHTML='';
      if(board[r][c]){
        const piece = document.createElement('div');
        piece.className='piece ' + (board[r][c]===1?'black':'white');
        cell.appendChild(piece);
      }
    }
  }
  infoEl.textContent = '手番: ' + (currentPlayer===1?'黒':'白');
}

function onCellClick(e){
  const r = parseInt(e.currentTarget.dataset.row);
  const c = parseInt(e.currentTarget.dataset.col);
  if(playMove(r,c,currentPlayer)){
    currentPlayer = 3 - currentPlayer; //switch player
    if(!hasValidMove(currentPlayer)){
      currentPlayer = 3 - currentPlayer; //skip turn
      if(!hasValidMove(currentPlayer)){
        alert('ゲーム終了! 黒:' + countPieces(1) + ' 白:' + countPieces(2));
        initBoard();
      }
    }
    drawBoard();
  }
}

const dirs = [[1,0],[-1,0],[0,1],[0,-1],[1,1],[-1,-1],[1,-1],[-1,1]];
function playMove(r,c,player){
  if(board[r][c]!==0) return false;
  let valid=false;
  for(const [dr,dc] of dirs){
    let rr=r+dr, cc=c+dc, captured=[];
    while(rr>=0&&rr<size&&cc>=0&&cc<size&&board[rr][cc]===3-player){
      captured.push([rr,cc]); rr+=dr; cc+=dc;
    }
    if(captured.length>0 && rr>=0&&rr<size&&cc>=0&&cc<size&&board[rr][cc]===player){
      valid=true;
      for(const [cr,ccp] of captured){ board[cr][ccp]=player; }
    }
  }
  if(valid){
    board[r][c]=player;
  }
  return valid;
}

function hasValidMove(player){
  for(let r=0;r<size;r++){
    for(let c=0;c<size;c++){
      if(isValid(r,c,player)) return true;
    }
  }
  return false;
}

function isValid(r,c,player){
  if(board[r][c]!==0) return false;
  for(const [dr,dc] of dirs){
    let rr=r+dr, cc=c+dc, found=false;
    while(rr>=0&&rr<size&&cc>=0&&cc<size&&board[rr][cc]===3-player){
      rr+=dr; cc+=dc; found=true;
    }
    if(found && rr>=0&&rr<size&&cc>=0&&cc<size&&board[rr][cc]===player){
      return true;
    }
  }
  return false;
}

function countPieces(player){
  let count=0;
  for(let r=0;r<size;r++){
    for(let c=0;c<size;c++){
      if(board[r][c]===player) count++;
    }
  }
  return count;
}

initBoard();
createBoardUI();
drawBoard();
</script>
</body>
</html>
